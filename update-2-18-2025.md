# Update — 2025-02-18

Summary of recent changes, where to find them, and quick verification steps.

## Overview
- Implemented schedule CRUD (Admin/Dean) and student schedule selection.
- Implemented cashier/student payment flows: tuition assessments, pending verifications, transaction processing, official receipt generation, and student notifications.
- Fixed several runtime and compile issues (undefined icon usages, hard-coded assessment total, missing exports).
- Added Student notification UI and a Grades view entry.
- Split Dean Approval Requests into Enrollments / Curriculum Updates / Grades and added Dean analytics consumption.

## Backend (where to look)

- `src/backend-setup/src/controllers/cashier.controller.ts` — transaction processing, `processTransaction` updates (transaction/enrollment status), official receipt generation (`uploads/documents/official_receipt_tx_<id>.txt`), `documents` insertion, `activity_logs` and `notifications` creation. Also exports `listTuitionAssessments` and `approveTuitionAssessment` handlers used by routes.

- `src/backend-setup/src/controllers/payments.controller.ts` — replaced placeholder assessment (`15000`) with a lookup of the student`s latest enrollment and a fee breakdown (tuition, registration, library, lab, id_fee, others). Computes paid/due using local payments records.

- `src/backend-setup/src/controllers/registrar.controller.ts` — `assignStudentToSection` present (updates `enrollments.section_id` and logs activity); registrar-related endpoints used by the Registrar UI.

- `src/backend-setup/src/controllers/analytics.controller.ts` — dean analytics endpoints consumed by `DeanDashboard` (students per program/year, subject demand, teaching load summary).

- `src/backend-setup/src/routes/cashier.routes.ts` — routes for listing and approving tuition assessments that reference the cashier controller handlers.

- `src/backend-setup/src/server.ts` — API route registrations (e.g., `/api/cashier`, `/api/payments`, `/api/registrar`, `/api/analytics`, `/api/notifications`) and static `uploads` mount.

## Frontend (where to look)

- `src/components/StudentDashboard.tsx` — added `Grades` button/view; notification bell/modal usage; replaced undefined `DollarSign` icon with `₱` peso symbol; schedule selection fallback (uses `es.schedule`, then `es.schedule_day_time`, then first item of `es.schedule_options`).

- `src/components/CashierDashboard.tsx` — removed undefined `DollarSign` icon import; added small `PesoIcon` and replaced occurrences; added Tuition Assessments and Pending Verifications views and hooks to `cashier.service`.

- `src/components/DeanDashboard.tsx` — added `approvalView` state and split Approval Requests into Enrollments / Curriculum Updates / Grades; consumes `analytics.service` for summary charts/lists.

- `src/components/RegistrarDashboard.tsx` — Registrar UI calls `registrarService.assignSection` (section assignment dialog and endpoints wired); contains subject assessment and enrollment assessment dialogs.

## Services

- `src/services/registrar.service.ts` — client methods: `assignSection`, `getPendingSubjectAssessments`, `assessEnrollment`, `approveSubjectAssessment`, `verifyPayment`, etc.

- `src/services/cashier.service.ts` — (new/extended) `getTuitionAssessments()` and `approveAssessment()` used by `CashierDashboard`.

- `src/services/payments.service.ts` — `getAssessment()` now queries backend `payments.controller` for enrollment-derived breakdown.

## Files, uploads, and DB artifacts

- Generated official receipts are saved under: `src/backend-setup/uploads/documents/` as `official_receipt_tx_<transactionId>.txt`.
- Notifications, activity logs, documents, and transactions are inserted into respective DB tables (see controllers above).

## Fixes applied

- Replaced runtime `ReferenceError: DollarSign is not defined` by removing the undefined icon and using an inline `₱` or `PesoIcon` where needed:
  - `src/components/StudentDashboard.tsx`
  - `src/components/CashierDashboard.tsx`

- Replaced hard-coded assessment total (`15000`) in `payments.controller.ts` with a real lookup of the student`s latest enrollment and fee breakdown.

- Exported missing handlers from `cashier.controller.ts` that were referenced by `cashier.routes.ts` (`listTuitionAssessments`, `approveTuitionAssessment`).

## Quick verification (recommended smoke test)

1. Start backend (inside `src/backend-setup`):

```powershell
cd "src/backend-setup"
npm install
npm run db:setup
npm run dev
```

2. Start frontend (repo root):

```powershell
cd "c:\Users\Ed\Desktop\work files\enroll-sys"
npm install
npm run dev
```

3. Test flow:
- As a student: select schedule, submit enrollment/subject selection, upload tentative receipt if testing partial flow.
- As registrar: assess enrollment / assign section for the student via the Registrar UI.
- As cashier: view Tuition Assessments, approve a pending transaction — check `uploads/documents/official_receipt_tx_<id>.txt` exists and a `notifications` DB row was created for the student.

## Related notes & next steps

- Dean `Curriculum Updates` approval list and Admin digital forms / faculty add-edit UI are partially implemented or pending wiring — see TODOs in project manifest and the in-repo todo tracker.
- Real-time notification delivery (websockets) is not implemented; current implementation inserts rows into `notifications` and the frontend polls for them. Consider adding websockets if required.

## Other artifacts

- `2-11-update.md` — previous changelog present in repository.


